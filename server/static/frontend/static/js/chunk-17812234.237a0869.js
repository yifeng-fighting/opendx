(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-17812234"],{"1f53":function(t,e,n){"use strict";n.d(e,"a",(function(){return r})),n.d(e,"b",(function(){return o})),n.d(e,"e",(function(){return i})),n.d(e,"d",(function(){return l})),n.d(e,"c",(function(){return c}));var a=n("b775");function r(t){return Object(a["a"])({method:"post",url:"/globalVar/add",data:t})}function o(t){return Object(a["a"])({method:"post",url:"/globalVar/addBatch",data:t})}function i(t){return Object(a["a"])({method:"post",url:"/globalVar/update",data:t})}function l(t){return Object(a["a"])({method:"post",url:"/globalVar/list",params:t})}function c(t){return Object(a["a"])({method:"delete",url:"/globalVar/".concat(t)})}},"6d17":function(t,e,n){"use strict";n.d(e,"a",(function(){return r})),n.d(e,"b",(function(){return o})),n.d(e,"d",(function(){return i})),n.d(e,"c",(function(){return l}));var a=n("b775");function r(t){return Object(a["a"])({method:"post",url:"/environment/add",data:t})}function o(t){return Object(a["a"])({method:"delete",url:"/environment/".concat(t)})}function i(t){return Object(a["a"])({method:"post",url:"/environment/update",data:t})}function l(t){return Object(a["a"])({method:"post",url:"/environment/list",params:t})}},"78dd":function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("add-global-vars")},r=[],o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("el-container",{staticStyle:{height:"100%"}},[n("el-header",{attrs:{height:"50px"}},[n("el-select",{attrs:{clearable:"",filterable:"",placeholder:"选择分类"},on:{"visible-change":t.categorySelectChange},model:{value:t.selectedCategoryId,callback:function(e){t.selectedCategoryId=e},expression:"selectedCategoryId"}},t._l(t.categories,(function(t){return n("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),1),t._v(" "),n("el-button",{attrs:{type:"primary"},on:{click:t.addGlobalVars}},[t._v("保 存")])],1),t._v(" "),n("el-main",[n("el-table",{attrs:{data:t.globalVars,border:""}},[n("el-table-column",{attrs:{align:"center",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[n("el-input",{attrs:{clearable:""},model:{value:a.type,callback:function(e){t.$set(a,"type","string"===typeof e?e.trim():e)},expression:"row.type"}})]}}])},[n("template",{slot:"header"},[n("span",{staticClass:"required"},[t._v("变量类型")])])],2),t._v(" "),n("el-table-column",{attrs:{align:"center",width:"200"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[n("el-input",{attrs:{clearable:""},model:{value:a.name,callback:function(e){t.$set(a,"name","string"===typeof e?e.trim():e)},expression:"row.name"}})]}}])},[n("template",{slot:"header"},[n("span",{staticClass:"required"},[t._v("变量名")])])],2),t._v(" "),n("el-table-column",{attrs:{align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[n("el-table",{attrs:{data:a.environmentValues,border:""}},[n("el-table-column",{attrs:{align:"center",label:"环境",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"选择环境"},on:{"visible-change":t.envSelectChange},model:{value:e.row.environmentId,callback:function(n){t.$set(e.row,"environmentId",n)},expression:"scope.row.environmentId"}},t._l(t.environmentList,(function(t){return n("el-option",{key:t.id,attrs:{value:t.id,label:t.name}})})),1)]}}],null,!0)}),t._v(" "),n("el-table-column",{attrs:{align:"center",label:"值"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("image-input",{model:{value:e.row.value,callback:function(n){t.$set(e.row,"value","string"===typeof n?n.trim():n)},expression:"scope.row.value"}})]}}],null,!0)}),t._v(" "),n("el-table-column",{attrs:{align:"center",label:"操作",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("el-button-group",[n("el-button",{on:{click:function(n){return t.addEnvironmentValue(a,e.$index)}}},[t._v("+")]),t._v(" "),n("el-button",{attrs:{disabled:0===e.$index},on:{click:function(n){return t.delEnvironmentValue(a,e.$index)}}},[t._v("-")])],1)]}}],null,!0)})],1)]}}])},[n("template",{slot:"header"},[n("span",{staticClass:"required"},[t._v("变量值")])])],2),t._v(" "),n("el-table-column",{attrs:{align:"center",label:"描述",width:"200"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[n("el-input",{attrs:{type:"textarea"},model:{value:a.description,callback:function(e){t.$set(a,"description","string"===typeof e?e.trim():e)},expression:"row.description"}})]}}])}),t._v(" "),n("el-table-column",{attrs:{label:"操作",align:"center",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("el-button-group",[n("el-button",{on:{click:function(n){return t.addGlobalVar(e.$index)}}},[t._v("+")]),t._v(" "),n("el-button",{attrs:{disabled:0===e.$index},on:{click:function(n){return t.delGlobalVar(e.$index)}}},[t._v("-")])],1)]}}])})],1)],1)],1)},i=[],l=(n("ac6a"),n("1f53")),c=n("c405"),u=n("6d17"),s=n("ab2e"),d={components:{ImageInput:s["a"]},data:function(){return{selectedCategoryId:void 0,globalVars:[{type:"String",name:"",environmentValues:[{environmentId:-1,value:""}],description:"",categoryId:void 0,projectId:void 0}],environmentList:[],categories:[]}},created:function(){this.fetchEnvironmentList(),this.fetchCategoryList()},computed:{projectId:function(){return this.$store.state.project.id}},methods:{fetchCategoryList:function(){var t=this;Object(c["c"])({projectId:this.projectId,type:3}).then((function(e){t.categories=e.data}))},categorySelectChange:function(t){t&&this.fetchCategoryList()},envSelectChange:function(t){t&&this.fetchEnvironmentList()},addGlobalVar:function(t){this.globalVars.splice(t+1,0,{type:"String",name:"",environmentValues:[{environmentId:-1,value:""}],description:"",categoryId:void 0,projectId:void 0})},delGlobalVar:function(t){this.globalVars.splice(t,1)},addGlobalVars:function(){var t=this;this.globalVars.forEach((function(e){e.categoryId=t.selectedCategoryId,e.projectId=t.projectId})),Object(l["b"])(this.globalVars).then((function(e){t.$notify.success(e.msg),t.$store.dispatch("tagsView/delView",t.$store.state.tagsView.visitedViews.filter((function(e){return e.path===t.$route.path}))[0]),t.$router.back()}))},fetchEnvironmentList:function(){var t=this;Object(u["c"])({projectId:this.projectId}).then((function(e){t.environmentList=[{id:-1,name:"默认"}].concat(e.data)}))},addEnvironmentValue:function(t,e){t.environmentValues.splice(e+1,0,{environmentId:void 0,value:""})},delEnvironmentValue:function(t,e){t.environmentValues.splice(e,1)}}},f=d,p=n("2877"),b=Object(p["a"])(f,o,i,!1,null,null,null),m=b.exports,v={name:"AddGlobalVar",components:{AddGlobalVars:m}},h=v,g=Object(p["a"])(h,a,r,!1,null,"525f3a7a",null);e["default"]=g.exports},ab2e:function(t,e,n){"use strict";var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("span",[t.isBase64Png?n("el-image",{staticStyle:{width:"100px"},attrs:{src:t.src,"preview-src-list":[t.src]}}):t._e(),t._v(" "),t.isBase64Png?n("el-input",{staticStyle:{width:"100px"},attrs:{clearable:""},nativeOn:{paste:function(e){return t.onpaste(e)}},model:{value:t.currentValue,callback:function(e){t.currentValue="string"===typeof e?e.trim():e},expression:"currentValue"}}):t._e(),t._v(" "),t.isBase64Png?t._e():n("el-input",{attrs:{type:"textarea",autosize:{minRows:1,maxRows:10}},nativeOn:{paste:function(e){return t.onpaste(e)}},model:{value:t.currentValue,callback:function(e){t.currentValue="string"===typeof e?e.trim():e},expression:"currentValue"}})],1)},r=[],o=(n("4917"),n("f559"),n("c5f6"),{name:"ImageInput",props:{value:[String,Number]},data:function(){return{base64PngSrcPrefix:"data:image/png;base64,",base64PngPrefix:"iVBORw0KGgoAAAANSUhEUgAA",currentValue:this.value}},computed:{isBase64Png:function(){return!!this.currentValue&&this.currentValue.startsWith(this.base64PngPrefix)},src:function(){return this.base64PngSrcPrefix+this.currentValue}},watch:{value:function(t){this.currentValue=t},currentValue:function(t){this.$emit("input",t)}},methods:{onpaste:function(t){var e=this;if(t.clipboardData&&t.clipboardData.items){var n=t.clipboardData.items[0];if(n&&"file"===n.kind&&n.type.match(/^image\//i)){console.log("paste img to base64");var a=n.getAsFile(),r=new FileReader;r.onload=function(t){e.currentValue=t.target.result.substring(22)},r.readAsDataURL(a)}}}}}),i=o,l=n("2877"),c=Object(l["a"])(i,a,r,!1,null,null,null);e["a"]=c.exports},c405:function(t,e,n){"use strict";n.d(e,"a",(function(){return r})),n.d(e,"b",(function(){return o})),n.d(e,"e",(function(){return i})),n.d(e,"c",(function(){return l})),n.d(e,"d",(function(){return c}));var a=n("b775");function r(t){return Object(a["a"])({method:"post",url:"/category/add",data:t})}function o(t,e,n){return Object(a["a"])({method:"delete",url:"/category/".concat(t,"/type/").concat(e,"/project/").concat(n)})}function i(t){return Object(a["a"])({method:"post",url:"/category/update",data:t})}function l(t){return Object(a["a"])({method:"post",url:"/category/list",params:t})}function c(t,e){return Object(a["a"])({method:"get",url:"/category/tree",params:{projectId:t,type:e}})}},f559:function(t,e,n){"use strict";var a=n("5ca1"),r=n("9def"),o=n("d2c8"),i="startsWith",l=""[i];a(a.P+a.F*n("5147")(i),"String",{startsWith:function(t){var e=o(this,t,i),n=r(Math.min(arguments.length>1?arguments[1]:void 0,e.length)),a=String(t);return l?l.call(e,a,n):e.slice(n,n+a.length)===a}})}}]);